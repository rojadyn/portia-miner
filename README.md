# portia-miner
Datamining utility for My Time at Portia

## Disclaimer
This script is by no means perfect-- it was originally created to gather a small amount of data, but has since grown. As a result, the code is currently a mish mash of many different things (so please forgive its inefficiencies).
In the future, the script will be optimized to run more quickly, and more documentation will be added to the script itself to make it easier to understand.
Feel free to make suggestions or point out problems, and we'll do what we can to address them soon. You can also make your own changes and open a pull request.

## What you'll need
* [Python 3](https://www.python.org/downloads/): To execute the script. MUST be Python 3, not Python 2.
* [Notepad++](https://notepad-plus-plus.org/download/v7.6.3.html) (Recommended): For viewing the output files generated by this script. Some of these can be pretty large, Notepad++ handles large files well so it is recommended.
* [DB Browser for SQLite](https://sqlitebrowser.org/dl/) or similar software (Optional): To browse the game database manually
* **portia-miner**: This project, which you can download here on this page

### How to navigate the files used by the script
1. Clone the repository with `git clone https://github.com/rojadyn/portia-miner.git` or download as a zip file
2. Locate the folder **portia-miner**
3. Inside that folder, you will find the following important files:
   * **main.py** - This is the most important part of the script. It interfaces with the game's database to pull out game data.
   * **all.txt** - After the script finishes running, this is where you will find all of the data pulled from the game's database.
   * **datasets** folder - This contains subfolders, which in turn contain python scripts that describe data that can pulled from the database, and how it can be transformed into something human-readable. There is a subfolder for each of the following topics: Animals, BTS (Behind the Scenes), Characters, Commerce Guild, Cooking, Crafting, Dates/Minigames, Dialogue, Dungeons, Factory, Farming, Festivals, Fish, Furniture, Gathering, Gifting, House, Items, Map, Missions, Museum, Recycling, Relationship Mechanic, Shops, Skills, Spar, Treasure Chests, Weather

### How to view the game's database
1. Launch DB Browser for SQLite.
2. Select Open Database and locate the database in the game's files. (You will have to find this in your copy of the game.) In a typical Steam installation, you will find it at the following location:
```
Local Disk (C:) > Program Files (x86) > Steam > steamapps > common > My Time at Portia > Portia_Data > Streaming Assets > CccData > LocalDb.bytes
```
3. Once you've opened the database, you can start browsing its many tables.

## Running the script
### How to run the script to extract all information from the database
1. Run **main.py** using python (e.g. `python main.py`)
2. Run main.py and wait for the full script to run. (This will take some time.) In addition to printing the mined data to the console, it will also be saved in .txt files. Each python script under datasets will result in the generation of a corresponding text file containing the resulting output for that file (e.g. output for portia-miner > datasets > Fish > FishList.py will be saved to portia-miner > datasets > Fish > FishList.txt). Additionally, every time the script is run, the full output will also be saved in **all.txt** in the same folder as **main.py**. If errors are encountered while processing a python file under the "datasets" folder, the error message will be saved in the corresponding .txt file rather than the datamined information.

### How to run only the parts of the script that you want
Locate the following lines of code in **main.py**, near the end of the script:
```
if __name__ == '__main__':
    folder = os.path.join('datasets')
    files = []
```
* If you leave the code above unchanged, the script will run on every folder and every file contained within the datasets folder. To narrow the scope of the script, you can specify a subfolder within the datasets folder, which will run the script on that subfolder only, or you can specify a file within the datasets folder, which will run the script on that file only.
* To specify a certain subfolder within "datasets", you can change the code like so (in this example, the subfolder is "Fish"):
```
if __name__ == '__main__':
    folder = os.path.join('datasets', 'Fish')
    files = []
```
- To specify a certain file within "datasets", you can change the code like so (in this example, the file is "Fishlist", which is located in the subfolder "Fish"):
```
if __name__ == '__main__':
    folder = os.path.join('datasets', 'Fish')
    files = ['FishList']
```

*Note that the filenames in the "files" list must be relative to the path defined by the "folder" variable*

## Things to note while viewing the results of the script
* This script is a work in progress.
* Every time there is an update to the game, things change in the database, which sometimes breaks parts of the script. Most things in the script will continue to function. Feel free to let the owner know if you encounter new errors. 
* The database tends to be vague and requires interpretation, and we are still trying to understand certain areas of the database.
* You may notice that certain data labels in the script are marked with asterisks (** Example **). The asterisks simply point out that the owner of the script isn't 100% sure yet what the data attached to the label refers to, but it seems important enough that it should be included in the script anyway.
* The very last subfolder located in "datasets" is called "ztesting". This folder contains parts of the script that are broken, that may not be relevant, or that still need work before they can be useful. When they are ready to go, they will be moved to a non-testing subfolder. It is recommended that you disregard them until they are moved out of the testing folder.
